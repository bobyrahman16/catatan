<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catatan Harian</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">
  <header class="bg-green-600 text-white py-4 text-center text-xl font-bold">
    Catatan Harian
  </header>

  <main class="max-w-md mx-auto mt-4 px-4">
    <div class="space-y-3">
      <textarea id="isi" rows="3" placeholder="Apa yang kamu pikirkan?" class="w-full p-2 border rounded"></textarea>
      <button onclick="tambahCatatan()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">Simpan</button>
      <input type="text" id="pencarian" placeholder="Cari catatan..." oninput="tampilkanCatatan()" class="w-full p-2 border rounded">
    </div>

    <div id="daftar-catatan" class="mt-6 space-y-4 overflow-y-auto max-h-[60vh] pb-4">
      <!-- Catatan akan ditampilkan di sini -->
    </div>
  </main>

  <script>
    const API_URL = "https://api.sheet.best/sheets/33929ee7-21ee-42ec-9570-bc127a71e027"; // Ganti dengan Sheet.best milikmu

    const isiInput = document.getElementById("isi");
    const pencarianInput = document.getElementById("pencarian");
    const daftarCatatan = document.getElementById("daftar-catatan");

    async function tambahCatatan() {
      const isi = isiInput.value.trim();
      if (isi === "") return;

      const tanggal = new Date().toISOString().split("T")[0];
      const waktu = new Date().toLocaleString("id-ID");

      const data = { isi, tanggal, waktu };

      try {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        isiInput.value = "";
        await ambilCatatan();
      } catch (err) {
        alert("Gagal menyimpan catatan.");
        console.error(err);
      }
    }

    async function ambilCatatan() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        window.semuaCatatan = data;
        tampilkanCatatan();
      } catch (err) {
        console.error("Gagal mengambil data:", err);
      }
    }

    function tampilkanCatatan() {
      const keyword = pencarianInput.value.toLowerCase();
      daftarCatatan.innerHTML = "";

      const filtered = (window.semuaCatatan || []).filter(item =>
        (item.isi || "").toLowerCase().includes(keyword)
      );

      filtered.reverse().forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 shadow rounded border-l-4 border-green-500";
        card.innerHTML = `
          <div class="text-sm text-gray-600">${item.waktu || ""} (${item.tanggal || ""})</div>
          <p class="mt-2 whitespace-pre-wrap">${item.isi || ""}</p>
        `;
        daftarCatatan.appendChild(card);
      });
    }

    ambilCatatan();
  </script>
</body>
</html>
